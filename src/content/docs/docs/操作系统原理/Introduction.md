---
title : Introduction
sidebar : 
    order : 2
---
## 操作系统概念
操作系统（Operation System, OS）是**控制和管理整个计算机系统的硬件与软件资源**的系统软件。它合理地组织、调度计算机的工作与资源（如CPU、内存、I/O设备等）的分配，进而为用户和其他软件提供方便接口与环境。

操作系统是计算机系统中最基本的系统软件。

### 操作系统基本特征
+ 并发性：多个程序可以“同时”运行（宏观上并行，微观上串行）。
+ 共享性：系统资源可被多个用户或程序共同使用。
+ 虚拟性：通过某些技术将物理资源虚拟为多个逻辑资源，如虚拟内存、虚拟CPU。
+ 异步性：程序执行过程是不可预知的，常受中断机制控制。

这里对几个特征进行一些深入解释。

---

**并发性**

对于并发，我们只需要将其与并行进行区分即可。一个最简单的例子，左手和右手一起画画，这叫并行。一会使用左手，一会使用右手，两手不同时使用而是不停切换，这叫并发。在多道程序的环境下，一段时间内，宏观上有多道程序在同时执行，但是在每个时刻，单处理机环境下其实仅有一道程序能执行，所以微观上这些程序是分时交替执行的，只是分的时间片较小。操作系统的并发性是通过分时得以实现的。

---

**共享性**

共享分成两种资源共享方式：

+ 互斥共享方式：例如打印机的某些资源，同时只能允许一个进程访问。当某进程需要访问这类资源的时候，必须先提出请求，如果资源空闲，系统就将其分配给这个进程；如果其他进程访问了被占用的资源，必须等待，只能到正在访问的进程访问结束，释放资源后，才允许另一个进程访问。这种在一段时间内只允许一个进程访问的资源，被称为**临界资源。**
+ 同时访问方式：某类资源允许在一段时间内，宏观的被多个进程同时访问。微观上，这些进程可能是对资源进行分时访问的。一种典型的资源是磁盘设备。

并发和共享是操作系统两个最基本的特征，资源共享是以程序的并发为条件的，因为如果程序根本不能并发，就没有资源共享的问题存在了。而如果资源不能共享，程序的并发执行会被影响，甚至根本无法并发执行。这两个特征是互为存在的。

---

**虚拟性**

虚拟是指将一个物理上的实体变为若干逻辑上的对应物。物理实体是真实存在的，而虚拟是用户感知的结果，由操作系统通过技术手段实现。操作系统通过多道程序设计技术实现虚拟化，例如：

+ 虚拟处理器（虚拟CPU）：一个CPU同时服务多个终端用户，让每个用户感觉自己独占CPU。
+ 虚拟存储器：利用虚拟存储技术把有限的物理存储器扩展为用户感知的“无限”内存空间。
+ 虚拟I/O设备：将一个物理I/O设备虚拟为多个逻辑设备，让多个用户轮流使用，使其感知为独占。

虚拟的本质，是通过复用技术实现的，比如处理器的分时共享，存储器的空间复用。

---

**异步性**

异步性指在多道程序运行环境下，多个程序并发执行，由于资源有限，程序运行过程会中断、暂停，进度不可预测（例如，你不知道进程谁先结束，或者其中的执行顺序是否与你期望的一致），这种不连续性就称为异步。

异步的影响，主要是程序执行可能因资源争用或外部事件打断而出现执行顺序不一致、错误或异常。同时，异步带来的不确定性也反应了系统在动态环境下的运行机制。

因此，操作系统必须合理调度和控制异步行为，确保各个进程能够获得公平的运行机会，保证系统运行稳定高效。

### 操作系统的目标与功能
操作系统的目标就是给多道程序提供良好的运行环境。

主要需要以下功能：

+ 处理机管理
+ 存储器管理
+ 设备管理
+ 文件管理
+ 向用户提供便于操作的接口
+ 扩充机器

所以根据以上列出的需求，可以按照三个部分来总结操作系统的作用。

---

**操作系统作为计算机系统资源的管理者**

+ **处理器管理：**以进程为基本单位管理处理器资源，实现多任务并发。涉及进程调度、同步、通信、死锁处理与调度策略。
+ **存储器管理：**提供合理的分配与回收策略，提高存储器利用率。包括地址映射、内存保护、共享与交换等功能。
+ **文件管理：**管理信息的逻辑存储单位，涉及文件的组织、存储、目录结构及安全保护。
+ **设备管理：**响应用户I/O请求，提高设备利用率。管理I/O设备、缓冲、虚拟设备等。

---

**操作系统作为计算机与用户/硬件系统之间的接口**

+ **命令接口：**用户通过命令与系统交互。分为命令控制接口（解释器），即命令行形式输入并执行命令和脱机命令接口，即用户事先输入命令与作业，系统统一调度执行。
+ **程序接口：**程序通过系统调用请求服务，例如设备访问和存储分配。
+ **图形用户界面（GUI）：**通过图标、窗口等形式与系统交互，实质上就是对程序接口的封装。

---

**操作系统实现了对计算机资源的扩充**

没有操作系统，计算机仅为“裸机”，功能有限。操作系统通过软件手段扩展硬件功能，使资源利用更高效，体现为“虚拟机”。因此操作系统常被看作“软件的机器”，起到桥梁与增强作用。

---

## 发展历程
~~这种废话真的要写到复习材料里吗~~

**手工操作阶段**

此时还没有操作系统，用户在计算机上所有的工作都需要人工干预，比如程序的装入、运行、结果输出。虽然不会出现资源等待现象，但是效率极低，且CPU利用不充分。

**批处理阶段**

这里开始出现操作系统了，被称为批处理系统。

分为单道批处理系统和多道批处理系统。单道批处理系统让磁带的一批作业能自动逐个运行，按照顺序，且同一时间内存中仅有一道程序运行。它的问题是，每次它在**运行期间**发出了IO请求后，高速的CPU便处于等待低速的IO完成的状态。

因此引入了多道批处理系统，允许多个程序同时进入内存，并且在CPU中交替运行。效率翻倍了，但是实现更复杂了。

**分时操作系统**

将处理器的运行时间分成很短的时间片，按照时间片轮流把处理器分配给各联机作业使用。如果一个时间片不够，就先让出处理器，下一轮再运行。

**实时操作系统**

为了解决在某个时间限制内完成某些紧急任务，不需要时间片排队的情况。如果某个动作必须绝对地在规定的时刻内发生，称为**硬实时系统**；如果能接受偶尔违反规定且不会引起永久损害的情况，称为**软实时系统**。

**网络操作系统和分布式计算机系统**

**网络操作系统（Network OS）**将计算机网络中的多台计算机整合，统一管理和资源共享。主要特点是资源共享 + 通信功能。**分布式计算机系统（Distributed System）**是指多台计算机通过网络协同工作，逻辑上看作一个整体。特点有无主从结构，每台计算机地位平等；资源共享，每台计算机的资源可被其他计算机访问；协同完成任务，各计算机间协作，完成一个共同目标。

**个人计算机操作系统**

目前最广泛使用，比如Windows、Linux和MacOS。

---

## 运行环境
### 特权指令
特权指令就是指清内存、置时钟、分配系统资源、修改虚拟内存之类的指令，如果所有程序都能使用，则系统会很不安全。因此这些指令只能在Kernel Mode执行，不能直接提供给用户使用。

### 处理器运行模式
操作系统通过处理器的运行模式（或称权限级别）来实现对系统资源的保护和控制。通常划分为两种基本模式：**内核态（Kernel Mode）**和**用户态（User Mode）**。内核态下，CPU可以执行所有指令并访问全部硬件资源；而用户态受限，不能直接操作硬件或执行特权指令。这种模式划分的核心目的是防止用户程序对系统造成破坏，提高系统的稳定性和安全性。操作系统运行在内核态，而用户应用程序运行在用户态，二者通过“系统调用”等机制交互。

大多数操作系统的内核包括4方面内容，分别是：

+ 时钟管理，向用户提供标准的系统时间，并且通过时钟中断的管理，实现进程的切换（时间片调度）。
+ 中断机制，主要目的是提高 CPU 使用率和增强系统响应能力。系统通过中断来响应各种事件，如设备完成输入/输出、用户请求服务等。中断分为可屏蔽和不可屏蔽两类，前者允许被临时禁用，后者通常用于处理紧急情况如电源故障。此外，现代操作系统将中断作为系统工作的核心组成，用于调度、设备驱动、系统调用等操作。
+ 原语，是操作系统中最底层、不可中断的基本操作，如对进程控制块的修改、资源分配等，具有原子性和高频率调用的特点。这些原语必须在内核态执行，确保操作的完整性和系统的安全性。
+ 系统控制的数据结构及处理，操作系统需用一些数据结构管理资源和进程，如进程控制块（PCB）、设备控制块、文件控制块等。这些结构用于记录资源状态和调度信息，实现进程管理、内存管理、文件管理和设备管理等核心功能。系统通过这些结构执行基本操作，如进程切换、内存分配与回收、文件目录维护等。

---

### 中断和异常
中断（Interrupt）和异常（Exception）是处理器对某些事件的响应机制，它们都可以打断当前正在执行的程序并转去执行特定的处理程序。中断通常来源于外部设备，如I/O完成、定时器到期、网络事件等，强调异步发生；而异常则通常是程序运行过程中产生的问题，如除零错误、非法访问、缺页等，强调同步发生。处理器响应中断或异常时会暂时保存当前上下文，转去执行操作系统提供的中断/异常处理例程，处理完成后再返回原程序继续执行。这一机制确保系统具备实时响应能力和故障容错能力。

中断分为可屏蔽（通过INTR触发）和不可屏蔽（如NMI）。可屏蔽中断可被程序临时禁用，处理灵活；不可屏蔽中断处理紧急故障，必须立即响应。异常则分为故障（Fault）、陷阱（Trap）和终止（Abort）三类，分别对应不同的程序错误与处理机制。

中断和异常处理过程从捕捉信号开始，CPU保存当前程序上下文，转入内核态执行相应处理程序。处理完毕后，恢复程序上下文继续执行。此过程确保系统在处理异常时保持稳定性和数据一致性，是用户态与内核态切换的核心机制之一。

---

### 系统调用
系统调用（System Call）是用户程序请求操作系统服务的唯一正规途径。由于用户态程序无法直接访问硬件或执行敏感操作，如文件读写、进程创建、内存分配等，它必须通过系统调用接口向操作系统“提出申请”。调用过程一般包括参数传递、陷入指令（如 int 0x80、syscall 等）引发从用户态切换到内核态，然后由内核执行相应功能，最后再切回用户态继续执行。系统调用既是用户和操作系统之间的桥梁，也是实现资源受控访问的关键机制。常见调用包括：文件管理、设备管理、进程控制、进程通信等。

---

## 操作系统结构
### 分层法（Layered Approach）
分层结构是一种将操作系统划分为若干层次的设计方法，每一层只依赖于下层所提供的服务，对上层提供接口。最底层接近硬件，如硬件抽象层，最上层则面向用户，如系统调用或用户接口。这种结构具有良好的模块化和可维护性，便于系统功能的逐步开发与测试，但缺点是层次间通信开销较大，可能影响效率。

### 模块化结构（Modular Structure）
模块化结构将操作系统设计成若干功能模块，每个模块封装特定的功能，如文件系统、进程调度、内存管理等，各模块通过统一接口或服务调用机制进行通信。该结构兼顾了灵活性和高效性，便于系统扩展和维护，是现代UNIX/Linux系统常见的架构。它比分层法更灵活，不强制层次限制，适合复杂系统构建。

### 宏内核（Monolithic Kernel）
宏内核结构将操作系统的所有核心服务（如进程管理、内存管理、文件系统、设备驱动等）全部集成在一个内核中，以内核态运行。这种设计的优点是运行效率高、通信开销小，但缺点是模块耦合度高、维护困难，出错后整个系统可能崩溃。早期的UNIX就是典型的宏内核结构。

### 微内核（Microkernel）
微内核结构将操作系统内核最小化，只保留最基本的功能（如进程间通信、基本调度、中断处理等），将文件系统、驱动程序等非核心服务移出内核，作为用户态服务运行。优点是安全性好、系统稳定性高、易于扩展和移植，但由于用户态与内核态频繁切换，性能开销较大。代表系统有Mach、Minix等。

### 外核（Exokernel）
外核结构是一种极端“瘦身”的设计思路，核心思想是最小化内核功能并完全开放硬件资源的控制权给用户程序。外核不再抽象硬件，而是直接将资源交给用户程序管理，提高灵活性与性能。优点是最大程度释放性能潜力，缺点是对程序员要求极高，且开发复杂。MIT提出的Exokernel系统是该结构的代表。

---

## 虚拟机
虚拟机是一种利用软件模拟的计算机系统，它在一台物理计算机上“虚拟”出多个相互独立、功能完备的“虚拟计算机”。每个虚拟机都拥有自己的操作系统、应用程序和资源，彼此隔离、互不影响。虚拟机使得资源利用更高效，同时增强系统的安全性和可维护性。

虚拟机有两类不同的虚拟化方法。

### 第一类虚拟机
第一类虚拟机直接运行在物理硬件之上，它不依赖宿主操作系统，而是将虚拟机监视器（Hypervisor）安装在硬件上，统一管理多个虚拟机。每个虚拟机都可以运行自己的操作系统。这种结构的优点是性能高、效率好、隔离性强，常用于服务器虚拟化、数据中心和云计算平台。

### 第二类虚拟机
第二类虚拟机运行在现有的操作系统之上，其虚拟机监视器是一个普通应用程序，依赖宿主系统来访问硬件资源。这种方式部署方便、易于使用，适合个人用户测试不同系统或开发环境，但性能和隔离性较弱。典型例子包括VMware Workstation。

| 项目 | 第一类虚拟机 | 第二类虚拟机 |
| --- | --- | --- |
| 安装位置 | 直接在硬件上 | 安装在操作系统之上 |
| 性能 | 高 | 稍低（受宿主系统影响） |
| 隔离性 | 强 | 相对较弱 |
| 使用场景 | 数据中心、云计算、服务器 | 个人使用、开发测试环境 |
| 示例 | VMware ESXi、Xen | VirtualBox、VMware Workstation |


